<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unirme – Grupo Lázaro</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <!-- Header común -->
  <header class="header-fixed">
    <div class="container flex">
      <img src="img/logo.png" alt="Logo Grupo Lázaro" class="logo">
      <nav>
        <ul class="menu flex">
          <li><a href="index.html">Home</a></li>
          <li><a href="noticias.html">Noticias</a></li>
          <li><a href="unirme.html">Unirme</a></li>
          <li><a href="historias.html">Historias</a></li>
          <li><a href="nosotros.html">Nosotros</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Compartí tu historia</h1>
    <p class="intro-text">Todo es seguro. Podés elegir si querés aparecer con nombre o anónimo ❤️</p>

    <form id="form-unirme">
      <div class="form-group">
        <label for="nombre">Nombre (opcional)</label>
        <input type="text" id="nombre" name="nombre" placeholder="Ej: Matías" />
      </div>

      <div class="form-group">
        <label for="tipoEM">Tipo de Esclerosis Múltiple <span class="required">*</span></label>
        <select id="tipoEM" name="tipoEM" required>
          <option value="">Seleccioná tu fenotipo...</option>
          <option value="SCA">Síndrome clínico aislado (SCA)</option>
          <option value="EMRR">Remitente-recurrente (EMRR)</option>
          <option value="EMPP">Primaria progresiva (EMPP)</option>
          <option value="EMSP">Secundaria progresiva (EMSP)</option>
          <option value="No especificar">Prefiero no decir</option>
        </select>
      </div>

      <div class="form-group">
        <label for="historia">Tu historia <span class="required">*</span></label>
        <textarea id="historia" name="historia" rows="8" placeholder="Contanos tu experiencia..." required></textarea>
      </div>

      <div class="form-group checkbox">
        <label>
          <input type="checkbox" id="anonimo-checkbox">
          Quiero permanecer anónimo en el muro (no aparecerá mi nombre)
        </label>
      </div>

      <button type="submit" class="btn" id="submit-btn">Enviar con amor ❤️</button>
    </form>
  </main>

  <!-- Footer común -->
  <footer class="footer">
    <div class="container">
      <p>Grupo Lázaro © 2025 – No estás solo ❤️</p>
      <p>Contactanos: matii.toorres.06@gmail.com</p>
    </div>
  </footer>

  <script>
    const _DEFAULT_API = "https://lazaro-backend-sqlite.onrender.com/api";
    const API_URL = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
      ? 'http://localhost:5000/api'
      : _DEFAULT_API;

    const form = document.getElementById('form-unirme');
    const submitBtn = document.getElementById('submit-btn');

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      submitBtn.disabled = true;
      submitBtn.textContent = "Enviando...";

      let nombre = document.getElementById('nombre').value.trim();
      const esAnonimo = document.getElementById('anonimo-checkbox').checked;

      // Si quiere anonimato o no puso nombre → Anónimo
      if (esAnonimo || !nombre) {
        nombre = 'Anónimo';
      }

      const tipoEM = document.getElementById('tipoEM').value;
      const historia = document.getElementById('historia').value.trim();

      if (!tipoEM || !historia) {
        alert('Por favor completa el tipo de EM y tu historia');
        submitBtn.disabled = false;
        submitBtn.textContent = "Enviar con amor ❤️";
        return;
      }

      const payload = {
        nombre: nombre,
        tipoEM: tipoEM,
        historia: historia
      };

      try {
        const res = await fetch(`${API_URL}/stories`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error('Error ' + res.status);

        alert('¡Tu historia fue recibida! ❤️\nPendiente de aprobación en el muro.');
        form.reset();
      } catch (err) {
        console.error('Error', err);
        alert('Error enviando. Intentá de nuevo más tarde ❤️');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Enviar con amor ❤️";
      }
    });
  </script>
</body>

</html>